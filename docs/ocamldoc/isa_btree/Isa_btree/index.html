<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Isa_btree (isa_btree.Isa_btree)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">isa_btree</a> &#x00BB; Isa_btree</nav><h1>Module <code>Isa_btree</code></h1><h3 id="public-interfaces"><a href="#public-interfaces" class="anchor"></a>Public interfaces</h3><nav class="toc"><ul><li><a href="#collection-of-all-the-interfaces-in-a-separate-module-(we-pull-some-of-these-out-in-the-following).">Collection of all the interfaces in a separate module (we pull some of these out in the following).</a></li><li><a href="#constants">Constants</a></li><li><a href="#disk-backed-nodes">Disk-backed nodes</a></li><li><a href="#pre-map-ops">Pre-map ops</a></li><li><a href="#store-ops">Store ops</a></li><li><a href="#main-functionality:-make-a-b-tree">Main functionality: make a B-tree</a></li><li><a href="#internal-interfaces">Internal interfaces</a></li></ul></nav></header><div><div class="spec include"><div class="doc"><h3 id="assertion-checking-etc"><a href="#assertion-checking-etc" class="anchor"></a>Assertion checking etc</h3><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="Isa_export_wrapper/index.html#module-Isa_export_assert_flag">Isa_export_wrapper.Isa_export_assert_flag</a></code></span></summary><dl><dt class="spec value" id="val-enable_isa_checks"><a href="#val-enable_isa_checks" class="anchor"></a><code><span class="keyword">val</span> enable_isa_checks : unit <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-disable_isa_checks"><a href="#val-disable_isa_checks" class="anchor"></a><code><span class="keyword">val</span> disable_isa_checks : unit <span>&#45;&gt;</span> unit</code></dt></dl></details></div></div></div><section><header><h3 id="collection-of-all-the-interfaces-in-a-separate-module-(we-pull-some-of-these-out-in-the-following)."><a href="#collection-of-all-the-interfaces-in-a-separate-module-(we-pull-some-of-these-out-in-the-following)." class="anchor"></a>Collection of all the interfaces in a separate module (we pull some of these out in the following).</h3></header><dl><dt class="spec module" id="module-Isa_btree_intf"><a href="#module-Isa_btree_intf" class="anchor"></a><code><span class="keyword">module</span> <a href="Isa_btree_intf/index.html">Isa_btree_intf</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Jane Street-style interface file</p></dd></dl></section><section><header><h3 id="constants"><a href="#constants" class="anchor"></a>Constants</h3></header><dl><dt class="spec type" id="type-constants"><a href="#type-constants" class="anchor"></a><code><span class="keyword">type</span> constants</code><code> = <a href="Constants/index.html#type-constants">Constants.constants</a></code><code> = </code><code>{</code><table class="record"><tr id="type-constants.min_leaf_size" class="anchored"><td class="def field"><a href="#type-constants.min_leaf_size" class="anchor"></a><code>min_leaf_size : int;</code></td></tr><tr id="type-constants.max_leaf_size" class="anchored"><td class="def field"><a href="#type-constants.max_leaf_size" class="anchor"></a><code>max_leaf_size : int;</code></td></tr><tr id="type-constants.min_node_keys" class="anchored"><td class="def field"><a href="#type-constants.min_node_keys" class="anchor"></a><code>min_node_keys : int;</code></td></tr><tr id="type-constants.max_node_keys" class="anchored"><td class="def field"><a href="#type-constants.max_node_keys" class="anchor"></a><code>max_node_keys : int;</code></td></tr></table><code>}</code></dt></dl><dl><dt class="spec module" id="module-Constants"><a href="#module-Constants" class="anchor"></a><code><span class="keyword">module</span> <a href="Constants/index.html">Constants</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>B-tree constants: minimum leaf size etc. These constants should be chosen so that nodes and leaves fit in a block. Clearly this depends on the block size, the size of keys and values, the on-disk format etc.</p></dd></dl></section><section><header><h3 id="disk-backed-nodes"><a href="#disk-backed-nodes" class="anchor"></a>Disk-backed nodes</h3></header><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="Isa_btree_intf/index.html#module-Dnode_type">Isa_btree_intf.Dnode_type</a></code></span></summary><dl><dt class="spec type" id="type-dnode"><a href="#type-dnode" class="anchor"></a><code><span class="keyword">type</span> ('node, 'leaf) dnode</code><code> = (<span class="type-var">'node</span>, <span class="type-var">'leaf</span>) <a href="Isa_export/Disk_node/index.html#type-dnode">Isa_export.Disk_node.dnode</a></code><code> = </code><table class="variant"><tr id="type-dnode.Disk_node" class="anchored"><td class="def constructor"><a href="#type-dnode.Disk_node" class="anchor"></a><code>| </code><code><span class="constructor">Disk_node</span> <span class="keyword">of</span> <span class="type-var">'node</span></code></td></tr><tr id="type-dnode.Disk_leaf" class="anchored"><td class="def constructor"><a href="#type-dnode.Disk_leaf" class="anchor"></a><code>| </code><code><span class="constructor">Disk_leaf</span> <span class="keyword">of</span> <span class="type-var">'leaf</span></code></td></tr></table></dt><dd><p>Recall <code>dnode</code> type</p></dd></dl></details></div></div></div></section><section><header><h3 id="pre-map-ops"><a href="#pre-map-ops" class="anchor"></a>Pre-map ops</h3></header><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="Isa_btree_intf/index.html#module-Pre_map_ops_type">Isa_btree_intf.Pre_map_ops_type</a></code></span></summary><dl><dt class="spec type" id="type-pre_map_ops"><a href="#type-pre_map_ops" class="anchor"></a><code><span class="keyword">type</span> ('k, 'v, 'r, 'leaf, 'frame, 't) pre_map_ops</code><code> = </code><code>{</code><table class="record"><tr id="type-pre_map_ops.leaf_lookup" class="anchored"><td class="def field"><a href="#type-pre_map_ops.leaf_lookup" class="anchor"></a><code>leaf_lookup : <span class="type-var">'k</span> <span>&#45;&gt;</span> <span class="type-var">'leaf</span> <span>&#45;&gt;</span> <span class="type-var">'v</span> option;</code></td></tr><tr id="type-pre_map_ops.find" class="anchored"><td class="def field"><a href="#type-pre_map_ops.find" class="anchor"></a><code>find : r:<span class="type-var">'r</span> <span>&#45;&gt;</span> k:<span class="type-var">'k</span> <span>&#45;&gt;</span> (<span class="type-var">'r</span> * <span class="type-var">'leaf</span> * <span class="type-var">'frame</span> list, <span class="type-var">'t</span>) Tjr_monad.m;</code></td></tr><tr id="type-pre_map_ops.insert" class="anchored"><td class="def field"><a href="#type-pre_map_ops.insert" class="anchor"></a><code>insert : r:<span class="type-var">'r</span> <span>&#45;&gt;</span> k:<span class="type-var">'k</span> <span>&#45;&gt;</span> v:<span class="type-var">'v</span> <span>&#45;&gt;</span> (<span class="type-var">'r</span> option, <span class="type-var">'t</span>) Tjr_monad.m;</code></td></tr><tr id="type-pre_map_ops.delete" class="anchored"><td class="def field"><a href="#type-pre_map_ops.delete" class="anchor"></a><code>delete : r:<span class="type-var">'r</span> <span>&#45;&gt;</span> k:<span class="type-var">'k</span> <span>&#45;&gt;</span> (<span class="type-var">'r</span>, <span class="type-var">'t</span>) Tjr_monad.m;</code></td></tr></table><code>}</code></dt><dd><p>Pre-map ops, with an explicit root pointer</p></dd></dl></details></div></div></div></section><section><header><h3 id="store-ops"><a href="#store-ops" class="anchor"></a>Store ops</h3></header><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="Isa_btree_intf/index.html#module-Store_ops_type">Isa_btree_intf.Store_ops_type</a></code></span></summary><dl><dt class="spec type" id="type-store_ops"><a href="#type-store_ops" class="anchor"></a><code><span class="keyword">type</span> ('r, 'dnode, 't) store_ops</code><code> = </code><code>{</code><table class="record"><tr id="type-store_ops.read" class="anchored"><td class="def field"><a href="#type-store_ops.read" class="anchor"></a><code>read : <span class="type-var">'r</span> <span>&#45;&gt;</span> (<span class="type-var">'dnode</span>, <span class="type-var">'t</span>) Tjr_monad.m;</code></td></tr><tr id="type-store_ops.wrte" class="anchored"><td class="def field"><a href="#type-store_ops.wrte" class="anchor"></a><code>wrte : <span class="type-var">'dnode</span> <span>&#45;&gt;</span> (<span class="type-var">'r</span>, <span class="type-var">'t</span>) Tjr_monad.m;</code></td></tr><tr id="type-store_ops.rewrite" class="anchored"><td class="def field"><a href="#type-store_ops.rewrite" class="anchor"></a><code>rewrite : <span class="type-var">'r</span> <span>&#45;&gt;</span> <span class="type-var">'dnode</span> <span>&#45;&gt;</span> (<span class="type-var">'r</span> option, <span class="type-var">'t</span>) Tjr_monad.m;</code></td></tr><tr id="type-store_ops.free" class="anchored"><td class="def field"><a href="#type-store_ops.free" class="anchor"></a><code>free : <span class="type-var">'r</span> list <span>&#45;&gt;</span> (unit, <span class="type-var">'t</span>) Tjr_monad.m;</code></td></tr></table><code>}</code></dt></dl></details></div></div></div></section><section><header><h3 id="main-functionality:-make-a-b-tree"><a href="#main-functionality:-make-a-b-tree" class="anchor"></a>Main functionality: make a B-tree</h3></header><aside><p>A record of operations provided by the B-tree</p></aside><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="Isa_btree_intf/index.html#module-Pre_btree_ops_type">Isa_btree_intf.Pre_btree_ops_type</a></code></span></summary><dl><dt class="spec type" id="type-pre_btree_ops"><a href="#type-pre_btree_ops" class="anchor"></a><code><span class="keyword">type</span> ('k, 'v, 'r, 't, 'leaf, 'node, 'leaf_stream) pre_btree_ops</code><code> = </code><code>{</code><table class="record"><tr id="type-pre_btree_ops.find" class="anchored"><td class="def field"><a href="#type-pre_btree_ops.find" class="anchor"></a><code>find : r:<span class="type-var">'r</span> <span>&#45;&gt;</span> k:<span class="type-var">'k</span> <span>&#45;&gt;</span> (<span class="type-var">'r</span> * <span class="type-var">'leaf</span> * (<span class="type-var">'k</span>, <span class="type-var">'r</span>, <span class="type-var">'node</span>) <a href="Isa_btree_intf/Frame_type/index.html#type-frame">Isa_btree_intf.Frame_type.frame</a> list, <span class="type-var">'t</span>) Tjr_monad.m;</code></td></tr><tr id="type-pre_btree_ops.insert" class="anchored"><td class="def field"><a href="#type-pre_btree_ops.insert" class="anchor"></a><code>insert : r:<span class="type-var">'r</span> <span>&#45;&gt;</span> k:<span class="type-var">'k</span> <span>&#45;&gt;</span> v:<span class="type-var">'v</span> <span>&#45;&gt;</span> (<span class="type-var">'r</span> option, <span class="type-var">'t</span>) Tjr_monad.m;</code></td></tr><tr id="type-pre_btree_ops.delete" class="anchored"><td class="def field"><a href="#type-pre_btree_ops.delete" class="anchor"></a><code>delete : r:<span class="type-var">'r</span> <span>&#45;&gt;</span> k:<span class="type-var">'k</span> <span>&#45;&gt;</span> (<span class="type-var">'r</span>, <span class="type-var">'t</span>) Tjr_monad.m;</code></td></tr><tr id="type-pre_btree_ops.leaf_stream_ops" class="anchored"><td class="def field"><a href="#type-pre_btree_ops.leaf_stream_ops" class="anchor"></a><code>leaf_stream_ops : (<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'r</span>, <span class="type-var">'leaf_stream</span>, <span class="type-var">'t</span>) <a href="Isa_btree_intf/index.html#type-leaf_stream_ops">Isa_btree_intf.leaf_stream_ops</a>;</code></td></tr><tr id="type-pre_btree_ops.leaf_ops" class="anchored"><td class="def field"><a href="#type-pre_btree_ops.leaf_ops" class="anchor"></a><code>leaf_ops : (<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'leaf</span>) <a href="Isa_btree_intf/index.html#type-leaf_ops">Isa_btree_intf.leaf_ops</a>;</code></td></tr><tr id="type-pre_btree_ops.node_ops" class="anchored"><td class="def field"><a href="#type-pre_btree_ops.node_ops" class="anchor"></a><code>node_ops : (<span class="type-var">'k</span>, <span class="type-var">'r</span>, <span class="type-var">'node</span>) <a href="Isa_btree_intf/index.html#type-node_ops">Isa_btree_intf.node_ops</a>;</code></td></tr><tr id="type-pre_btree_ops.pre_map_ops" class="anchored"><td class="def field"><a href="#type-pre_btree_ops.pre_map_ops" class="anchor"></a><code>pre_map_ops : (<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'r</span>, <span class="type-var">'leaf</span>, (<span class="type-var">'k</span>, <span class="type-var">'r</span>, <span class="type-var">'node</span>) <a href="Isa_btree_intf/Frame_type/index.html#type-frame">Isa_btree_intf.Frame_type.frame</a>, <span class="type-var">'t</span>) <a href="Isa_btree_intf/index.html#type-pre_map_ops">Isa_btree_intf.pre_map_ops</a>;</code></td></tr><tr id="type-pre_btree_ops.insert_many" class="anchored"><td class="def field"><a href="#type-pre_btree_ops.insert_many" class="anchor"></a><code>insert_many : (<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'r</span>, <span class="type-var">'t</span>) <a href="Isa_btree_intf/index.html#type-insert_many_type">Isa_btree_intf.insert_many_type</a>;</code></td></tr><tr id="type-pre_btree_ops.insert_all" class="anchored"><td class="def field"><a href="#type-pre_btree_ops.insert_all" class="anchor"></a><code>insert_all : (<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'r</span>, <span class="type-var">'t</span>) <a href="Isa_btree_intf/index.html#type-insert_all_type">Isa_btree_intf.insert_all_type</a>;</code></td></tr></table><code>}</code></dt></dl></details></div></div></div><aside><p>This functor takes various types and constants (including, in particular, the type of keys and the value for the comparison on keys) and generates extra types <code>k_comparator...</code> for the map implementations. Then there is a function <code>make_btree_ops</code> which takes a <code>store_ops</code> and returns the B-tree operations.</p><p>Note that these are &quot;pre_btree_ops&quot; because they expose internal types that we may want to hide: leaf, node, frame, leaf_stream(?). See tjr_btree for the simpler versions.</p></aside><div class="spec module" id="module-Make"><a href="#module-Make" class="anchor"></a><code><span class="keyword">module</span> <a href="Make/index.html">Make</a> : <span class="keyword">functor</span> (<a href="Make/argument-1-S/index.html">S</a> : <a href="Isa_btree_intf/index.html#module-type-S">Isa_btree_intf.S</a>) <span>&#45;&gt;</span> <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></section><section><header><h3 id="internal-interfaces"><a href="#internal-interfaces" class="anchor"></a>Internal interfaces</h3></header><div class="spec module" id="module-Comparator_to_map_ops"><a href="#module-Comparator_to_map_ops" class="anchor"></a><code><span class="keyword">module</span> Comparator_to_map_ops = <a href="Isa_btree_util/index.html#module-Comparator_to_map_ops">Isa_btree_util.Comparator_to_map_ops</a></code></div><dl><dt class="spec value" id="val-make_with_comparators"><a href="#val-make_with_comparators" class="anchor"></a><code><span class="keyword">val</span> make_with_comparators : monad_ops:<span class="type-var">'a</span> Tjr_monad.monad_ops <span>&#45;&gt;</span> cs:<a href="../Isa_btree__/Constants_type/index.html#type-constants">Isa_btree__.Constants_type.constants</a> <span>&#45;&gt;</span> k_cmp:(<span class="type-var">'b</span>, <span class="type-var">'c</span>) Base.Map.comparator <span>&#45;&gt;</span> kopt_cmp:(<span class="type-var">'b</span> option, <span class="type-var">'d</span>) Base.Map.comparator <span>&#45;&gt;</span> store_ops:(<span class="type-var">'e</span>, ((<span class="type-var">'b</span> option, <span class="type-var">'e</span>, <span class="type-var">'d</span>) Base.Map.t, (<span class="type-var">'b</span>, <span class="type-var">'f</span>, <span class="type-var">'c</span>) Base.Map.t) <a href="../Isa_btree__Isa_export/Disk_node/index.html#type-dnode">Isa_btree__Isa_export.Disk_node.dnode</a>, <span class="type-var">'a</span>) <a href="Isa_btree_intf/index.html#type-store_ops">Isa_btree_intf.store_ops</a> <span>&#45;&gt;</span> (<span class="type-var">'b</span>, <span class="type-var">'f</span>, <span class="type-var">'e</span>, <span class="type-var">'a</span>, (<span class="type-var">'b</span>, <span class="type-var">'f</span>, <span class="type-var">'c</span>) Base.Map.t, (<span class="type-var">'b</span> option, <span class="type-var">'e</span>, <span class="type-var">'d</span>) Base.Map.t, (<span class="type-var">'e</span>, (<span class="type-var">'b</span>, <span class="type-var">'f</span>, <span class="type-var">'c</span>) Base.Map.t, (<span class="type-var">'b</span>, <span class="type-var">'e</span>, (<span class="type-var">'b</span> option, <span class="type-var">'e</span>, <span class="type-var">'d</span>) Base.Map.t) <a href="../Isa_btree__Isa_btree_intf/Frame_type/index.html#type-frame">Isa_btree_intf.Frame_type.frame</a>) <a href="../Isa_btree__Isa_export_wrapper/Internal_leaf_stream_impl/index.html#type-_t">Isa_export_wrapper.Internal_leaf_stream_impl._t</a>) <a href="../Isa_btree__Isa_btree_intf/Pre_btree_ops_type/index.html#type-pre_btree_ops">Isa_btree_intf.Pre_btree_ops_type.pre_btree_ops</a></code></dt></dl><div class="spec module" id="module-Make_with_first_class_module"><a href="#module-Make_with_first_class_module" class="anchor"></a><code><span class="keyword">module</span> <a href="Make_with_first_class_module/index.html">Make_with_first_class_module</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec module" id="module-Leaf_node_frame_impls"><a href="#module-Leaf_node_frame_impls" class="anchor"></a><code><span class="keyword">module</span> <a href="Leaf_node_frame_impls/index.html">Leaf_node_frame_impls</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd></dd></dl><dl><dt class="spec module" id="module-Isa_export"><a href="#module-Isa_export" class="anchor"></a><code><span class="keyword">module</span> <a href="Isa_export/index.html">Isa_export</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>This file is exported from Isabelle, and lightly patched (eg to include this comment!). The OCaml interfaces wrap this basic functionality.</p></dd></dl><dl><dt class="spec module" id="module-Isa_export_wrapper"><a href="#module-Isa_export_wrapper" class="anchor"></a><code><span class="keyword">module</span> <a href="Isa_export_wrapper/index.html">Isa_export_wrapper</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Wrap Isabelle-exported code in an OCaml-friendly interface</p></dd></dl><dl><dt class="spec module" id="module-Isa_btree_util"><a href="#module-Isa_btree_util" class="anchor"></a><code><span class="keyword">module</span> <a href="Isa_btree_util/index.html">Isa_btree_util</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Given a value <code>k_cmp</code>, construct the corresponding map_ops, with keys: k, k option</p></dd></dl><dl><dt class="spec module" id="module-Notes"><a href="#module-Notes" class="anchor"></a><code><span class="keyword">module</span> <a href="Notes/index.html">Notes</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Some notes on constructing the B-tree</p></dd></dl></section></div></body></html>