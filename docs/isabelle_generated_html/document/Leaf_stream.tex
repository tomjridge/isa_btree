%
\begin{isabellebody}%
\setisabellecontext{Leaf{\isacharunderscore}stream}%
%
\isadelimtheory
%
\endisadelimtheory
%
\isatagtheory
\isacommand{theory}\isamarkupfalse%
\ Leaf{\isacharunderscore}stream\ \isanewline
\isakeyword{imports}\ Find\ {\isachardoublequoteopen}{\isachardollar}SRC{\isacharslash}c{\isacharunderscore}monad{\isacharslash}Leaf{\isacharunderscore}stream{\isacharunderscore}state{\isachardoublequoteclose}\isanewline
\isakeyword{begin}%
\endisatagtheory
{\isafoldtheory}%
%
\isadelimtheory
\isanewline
%
\endisadelimtheory
\isanewline
\isanewline
\isacommand{definition}\isamarkupfalse%
\ step{\isacharunderscore}down\ {\isacharcolon}{\isacharcolon}\ {\isachardoublequoteopen}{\isacharprime}k\ ps{\isadigit{1}}\ {\isasymRightarrow}\ {\isacharparenleft}{\isacharprime}k{\isacharcomma}{\isacharprime}v{\isacharcomma}{\isacharprime}r{\isacharcomma}{\isacharprime}t{\isacharparenright}store{\isacharunderscore}ops\ {\isasymRightarrow}\ {\isacharprime}r{\isacharasterisk}{\isacharparenleft}{\isacharprime}k{\isacharcomma}{\isacharprime}r{\isacharparenright}rstk\ {\isasymRightarrow}\ {\isacharparenleft}{\isacharparenleft}{\isacharprime}k{\isacharcomma}{\isacharprime}v{\isacharcomma}{\isacharprime}r{\isacharparenright}lss{\isacharcomma}{\isacharprime}t{\isacharparenright}\ MM{\isachardoublequoteclose}\ \isakeyword{where}\isanewline
{\isachardoublequoteopen}step{\isacharunderscore}down\ ps{\isadigit{1}}\ store{\isacharunderscore}ops\ rfs\ {\isacharequal}\ {\isacharparenleft}\isanewline
\ \ let\ {\isacharparenleft}r{\isacharcomma}fs{\isacharparenright}\ {\isacharequal}\ rfs\ in\isanewline
\ \ {\isacharparenleft}{\isacharasterisk}\ let\ store{\isacharunderscore}ops\ {\isacharequal}\ ps{\isadigit{1}}{\isacharbar}{\isachargreater}dot{\isacharunderscore}store{\isacharunderscore}ops\ in\ {\isacharasterisk}{\isacharparenright}\isanewline
\ \ {\isacharparenleft}store{\isacharunderscore}ops{\isacharbar}{\isachargreater}store{\isacharunderscore}read{\isacharparenright}\ r\ {\isacharbar}{\isachargreater}\ fmap\ \isanewline
\ \ {\isacharparenleft}{\isacharpercent}\ f{\isachardot}\ case\ f\ of\ \isanewline
\ \ \ \ Disk{\isacharunderscore}node\ {\isacharparenleft}ks{\isacharcomma}rs{\isacharparenright}\ {\isasymRightarrow}\ {\isacharparenleft}\isanewline
\ \ \ \ \ \ let\ r{\isacharprime}\ {\isacharequal}\ List{\isachardot}hd\ rs\ in\isanewline
\ \ \ \ \ \ let\ rs{\isacharprime}\ {\isacharequal}\ List{\isachardot}tl\ rs\ in\isanewline
\ \ \ \ \ \ let\ frm\ {\isacharequal}\ {\isasymlparr}\ r{\isacharunderscore}ks{\isadigit{1}}{\isacharequal}{\isacharbrackleft}{\isacharbrackright}{\isacharcomma}r{\isacharunderscore}ts{\isadigit{1}}{\isacharequal}{\isacharbrackleft}{\isacharbrackright}{\isacharcomma}r{\isacharunderscore}t{\isacharequal}r{\isacharprime}{\isacharcomma}\ r{\isacharunderscore}ks{\isadigit{2}}{\isacharequal}ks{\isacharcomma}r{\isacharunderscore}ts{\isadigit{2}}{\isacharequal}rs{\isacharprime}\ {\isasymrparr}\ in\isanewline
\ \ \ \ \ \ LS{\isacharunderscore}down\ {\isacharparenleft}r{\isacharprime}{\isacharcomma}frm{\isacharhash}fs{\isacharparenright}{\isacharparenright}\ \ {\isacharparenleft}{\isacharasterisk}\ r{\isacharprime}\ {\isacharequal}\ f{\isacharunderscore}t\ of\ frm\ {\isacharasterisk}{\isacharparenright}\isanewline
\ \ \ \ {\isacharbar}\ Disk{\isacharunderscore}leaf\ {\isacharparenleft}kvs{\isacharparenright}\ {\isasymRightarrow}\ LS{\isacharunderscore}leaf\ {\isacharparenleft}kvs{\isacharcomma}fs{\isacharparenright}{\isacharparenright}\isanewline
{\isacharparenright}{\isachardoublequoteclose}\isanewline
\isanewline
\isanewline
\isacommand{definition}\isamarkupfalse%
\ step{\isacharunderscore}leaf\ {\isacharcolon}{\isacharcolon}\ {\isachardoublequoteopen}{\isacharparenleft}{\isacharprime}k{\isacharcomma}{\isacharprime}v{\isacharcomma}{\isacharprime}r{\isacharparenright}\ leaf{\isacharunderscore}ref\ {\isasymRightarrow}\ {\isacharparenleft}{\isacharprime}k{\isacharcomma}{\isacharprime}v{\isacharcomma}{\isacharprime}r{\isacharparenright}\ lss{\isachardoublequoteclose}\ \isakeyword{where}\isanewline
{\isachardoublequoteopen}step{\isacharunderscore}leaf\ r\ {\isacharequal}\ {\isacharparenleft}\isanewline
\ \ let\ {\isacharparenleft}kvs{\isacharcomma}fs{\isacharparenright}\ {\isacharequal}\ r\ in\isanewline
\ \ LS{\isacharunderscore}up\ fs\isanewline
{\isacharparenright}{\isachardoublequoteclose}\isanewline
\isanewline
\isanewline
\isacommand{definition}\isamarkupfalse%
\ step{\isacharunderscore}up\ {\isacharcolon}{\isacharcolon}\ {\isachardoublequoteopen}{\isacharparenleft}{\isacharprime}k{\isacharcomma}{\isacharprime}r{\isacharparenright}\ rstk\ {\isasymRightarrow}\ {\isacharparenleft}{\isacharprime}k{\isacharcomma}{\isacharprime}v{\isacharcomma}{\isacharprime}r{\isacharparenright}\ lss{\isachardoublequoteclose}\ \isakeyword{where}\isanewline
{\isachardoublequoteopen}step{\isacharunderscore}up\ fs\ {\isacharequal}\ {\isacharparenleft}\isanewline
\ \ let\ {\isacharunderscore}\ {\isacharequal}\ check{\isacharunderscore}true\ {\isacharparenleft}{\isacharpercent}{\isacharunderscore}{\isachardot}\ fs\ {\isasymnoteq}\ {\isacharbrackleft}{\isacharbrackright}{\isacharparenright}\ in\isanewline
\ \ case\ fs\ of\ \isanewline
\ \ {\isacharbrackleft}{\isacharbrackright}\ {\isasymRightarrow}\ {\isacharparenleft}failwith\ {\isacharparenleft}STR\ {\isacharprime}{\isacharprime}impossible{\isacharcolon}\ Leaf{\isacharunderscore}stream{\isachardot}step{\isacharunderscore}up{\isacharprime}{\isacharprime}{\isacharparenright}{\isacharparenright}\isanewline
\ \ {\isacharbar}\ f{\isacharhash}fs{\isacharprime}\ {\isasymRightarrow}\ {\isacharparenleft}\isanewline
\ \ \ \ let\ {\isacharparenleft}ks{\isadigit{1}}{\isacharcomma}rs{\isadigit{1}}{\isacharcomma}r{\isacharcomma}ks{\isadigit{2}}{\isacharcomma}rs{\isadigit{2}}{\isacharparenright}\ {\isacharequal}\ f{\isacharbar}{\isachargreater}dest{\isacharunderscore}rsplit{\isacharunderscore}node\ in\isanewline
\ \ \ \ case\ rs{\isadigit{2}}\ of\isanewline
\ \ \ \ {\isacharbrackleft}{\isacharbrackright}\ {\isasymRightarrow}\ {\isacharparenleft}LS{\isacharunderscore}up\ fs{\isacharprime}{\isacharparenright}\isanewline
\ \ \ \ {\isacharbar}\ r{\isacharprime}{\isacharhash}rs{\isacharprime}\ {\isasymRightarrow}\ {\isacharparenleft}\isanewline
\ \ \ \ \ \ let\ f{\isacharprime}\ {\isacharequal}\ {\isasymlparr}\ \isanewline
\ \ \ \ \ \ \ \ {\isacharparenleft}{\isacharasterisk}\ NOTE\ r{\isacharunderscore}ks{\isadigit{1}}{\isacharcomma}\ r{\isacharunderscore}ts{\isadigit{1}}\ stored\ in\ reverse\ {\isacharasterisk}{\isacharparenright}\isanewline
\ \ \ \ \ \ \ \ r{\isacharunderscore}ks{\isadigit{1}}{\isacharequal}{\isacharparenleft}List{\isachardot}hd\ ks{\isadigit{2}}{\isacharparenright}{\isacharhash}ks{\isadigit{1}}{\isacharcomma}\isanewline
\ \ \ \ \ \ \ \ r{\isacharunderscore}ts{\isadigit{1}}{\isacharequal}r{\isacharhash}rs{\isadigit{1}}{\isacharcomma}\isanewline
\ \ \ \ \ \ \ \ r{\isacharunderscore}t{\isacharequal}r{\isacharprime}{\isacharcomma}\ \isanewline
\ \ \ \ \ \ \ \ r{\isacharunderscore}ks{\isadigit{2}}{\isacharequal}{\isacharparenleft}List{\isachardot}tl\ ks{\isadigit{2}}{\isacharparenright}{\isacharcomma}\isanewline
\ \ \ \ \ \ \ \ r{\isacharunderscore}ts{\isadigit{2}}{\isacharequal}rs{\isacharprime}\ {\isasymrparr}\ \isanewline
\ \ \ \ \ \ in\isanewline
\ \ \ \ \ \ LS{\isacharunderscore}down\ {\isacharparenleft}r{\isacharprime}{\isacharcomma}f{\isacharprime}{\isacharhash}fs{\isacharprime}{\isacharparenright}\ {\isacharparenright}{\isacharparenright}{\isacharparenright}{\isachardoublequoteclose}\isanewline
\isanewline
\ \ \isanewline
\isacommand{definition}\isamarkupfalse%
\ lss{\isacharunderscore}step\ {\isacharcolon}{\isacharcolon}\ {\isachardoublequoteopen}{\isacharprime}k\ ps{\isadigit{1}}\ {\isasymRightarrow}\ {\isacharparenleft}{\isacharprime}k{\isacharcomma}{\isacharprime}v{\isacharcomma}{\isacharprime}r{\isacharcomma}{\isacharprime}t{\isacharparenright}\ store{\isacharunderscore}ops\ {\isasymRightarrow}\ {\isacharparenleft}{\isacharprime}k{\isacharcomma}{\isacharprime}v{\isacharcomma}{\isacharprime}r{\isacharparenright}\ lss\ {\isasymRightarrow}\ {\isacharparenleft}{\isacharparenleft}{\isacharprime}k{\isacharcomma}{\isacharprime}v{\isacharcomma}{\isacharprime}r{\isacharparenright}\ lss{\isacharcomma}{\isacharprime}t{\isacharparenright}\ MM{\isachardoublequoteclose}\ \isakeyword{where}\isanewline
{\isachardoublequoteopen}lss{\isacharunderscore}step\ ps{\isadigit{1}}\ store{\isacharunderscore}ops\ lss\ {\isacharequal}\ {\isacharparenleft}\isanewline
\ \ case\ lss\ of\ \isanewline
\ \ LS{\isacharunderscore}down\ x\ {\isasymRightarrow}\ {\isacharparenleft}step{\isacharunderscore}down\ ps{\isadigit{1}}\ store{\isacharunderscore}ops\ x{\isacharparenright}\isanewline
\ \ {\isacharbar}\ LS{\isacharunderscore}leaf\ x\ {\isasymRightarrow}\ {\isacharparenleft}return\ {\isacharparenleft}step{\isacharunderscore}leaf\ x{\isacharparenright}{\isacharparenright}\isanewline
\ \ {\isacharbar}\ LS{\isacharunderscore}up\ x\ {\isasymRightarrow}\ {\isacharparenleft}return\ {\isacharparenleft}step{\isacharunderscore}up\ x{\isacharparenright}{\isacharparenright}\ \isanewline
{\isacharparenright}{\isachardoublequoteclose}\isanewline
%
\isadelimtheory
\isanewline
%
\endisadelimtheory
%
\isatagtheory
\isacommand{end}\isamarkupfalse%
%
\endisatagtheory
{\isafoldtheory}%
%
\isadelimtheory
%
\endisadelimtheory
\end{isabellebody}%
%%% Local Variables:
%%% mode: latex
%%% TeX-master: "root"
%%% End:
