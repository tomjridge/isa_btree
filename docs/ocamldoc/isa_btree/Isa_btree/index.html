<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Isa_btree (isa_btree.Isa_btree)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">isa_btree</a> &#x00BB; Isa_btree</nav><h1>Module <code>Isa_btree</code></h1><p>Isabelle B-tree definitions, as an OCaml lib</p><nav class="toc"><ul><li><a href="#public-interfaces">Public interfaces</a></li><li><a href="#constants">Constants</a></li><li><a href="#node/leaf-conversions-to/from-lists">Node/leaf conversions to/from lists</a></li><li><a href="#pre-map-ops">Pre-map ops</a></li><li><a href="#store-ops">Store ops</a></li><li><a href="#main-functionality:-make_isa_btree">Main functionality: make_isa_btree</a></li><li><a href="#internal-interfaces">Internal interfaces</a></li></ul></nav></header><section><header><h3 id="public-interfaces"><a href="#public-interfaces" class="anchor"></a>Public interfaces</h3></header></section><section><header><h3 id="constants"><a href="#constants" class="anchor"></a>Constants</h3></header><dl><dt class="spec type" id="type-constants"><a href="#type-constants" class="anchor"></a><code><span class="keyword">type</span> constants</code><code> = <a href="Constants/index.html#type-constants">Constants.constants</a></code><code> = </code><code>{</code><table class="record"><tr id="type-constants.min_leaf_size" class="anchored"><td class="def field"><a href="#type-constants.min_leaf_size" class="anchor"></a><code>min_leaf_size : int;</code></td></tr><tr id="type-constants.max_leaf_size" class="anchored"><td class="def field"><a href="#type-constants.max_leaf_size" class="anchor"></a><code>max_leaf_size : int;</code></td></tr><tr id="type-constants.min_node_keys" class="anchored"><td class="def field"><a href="#type-constants.min_node_keys" class="anchor"></a><code>min_node_keys : int;</code></td></tr><tr id="type-constants.max_node_keys" class="anchored"><td class="def field"><a href="#type-constants.max_node_keys" class="anchor"></a><code>max_node_keys : int;</code></td></tr></table><code>}</code></dt></dl><dl><dt class="spec module" id="module-Constants"><a href="#module-Constants" class="anchor"></a><code><span class="keyword">module</span> <a href="Constants/index.html">Constants</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>B-tree constants: minimum leaf size etc. These constants should be chosen so that nodes and leaves fit in a block. Clearly this depends on the block size, the size of keys and values, the on-disk format etc.</p></dd></dl></section><section><header><h3 id="node/leaf-conversions-to/from-lists"><a href="#node/leaf-conversions-to/from-lists" class="anchor"></a>Node/leaf conversions to/from lists</h3></header><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="Isa_export_wrapper/index.html#module-Node_leaf_conversions_type">Isa_export_wrapper.Node_leaf_conversions_type</a></code></span></summary><dl><dt class="spec type" id="type-node_leaf_conversions"><a href="#type-node_leaf_conversions" class="anchor"></a><code><span class="keyword">type</span> ('k, 'v, 'r, 'node, 'leaf) node_leaf_conversions</code><code> = </code><code>{</code><table class="record"><tr id="type-node_leaf_conversions.node_to_krs" class="anchored"><td class="def field"><a href="#type-node_leaf_conversions.node_to_krs" class="anchor"></a><code>node_to_krs : <span class="type-var">'node</span> <span>&#45;&gt;</span> <span class="type-var">'k</span> list * <span class="type-var">'r</span> list;</code></td></tr><tr id="type-node_leaf_conversions.leaf_to_kvs" class="anchored"><td class="def field"><a href="#type-node_leaf_conversions.leaf_to_kvs" class="anchor"></a><code>leaf_to_kvs : <span class="type-var">'leaf</span> <span>&#45;&gt;</span> (<span class="type-var">'k</span> * <span class="type-var">'v</span>) list;</code></td></tr><tr id="type-node_leaf_conversions.krs_to_node" class="anchored"><td class="def field"><a href="#type-node_leaf_conversions.krs_to_node" class="anchor"></a><code>krs_to_node : (<span class="type-var">'k</span> list * <span class="type-var">'r</span> list) <span>&#45;&gt;</span> <span class="type-var">'node</span>;</code></td></tr><tr id="type-node_leaf_conversions.kvs_to_leaf" class="anchored"><td class="def field"><a href="#type-node_leaf_conversions.kvs_to_leaf" class="anchor"></a><code>kvs_to_leaf : (<span class="type-var">'k</span> * <span class="type-var">'v</span>) list <span>&#45;&gt;</span> <span class="type-var">'leaf</span>;</code></td></tr></table><code>}</code></dt><dd><p>Type for converting nodes and leaves into lists of k,v,r</p></dd></dl></details></div></div></div></section><section><header><h3 id="pre-map-ops"><a href="#pre-map-ops" class="anchor"></a>Pre-map ops</h3></header><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="Isa_export_wrapper/index.html#module-Pre_map_ops_type">Isa_export_wrapper.Pre_map_ops_type</a></code></span></summary><dl><dt class="spec type" id="type-pre_map_ops"><a href="#type-pre_map_ops" class="anchor"></a><code><span class="keyword">type</span> ('k, 'v, 'r, 'leaf, 'frame, 't) pre_map_ops</code><code> = </code><code>{</code><table class="record"><tr id="type-pre_map_ops.leaf_lookup" class="anchored"><td class="def field"><a href="#type-pre_map_ops.leaf_lookup" class="anchor"></a><code>leaf_lookup : <span class="type-var">'k</span> <span>&#45;&gt;</span> <span class="type-var">'leaf</span> <span>&#45;&gt;</span> <span class="type-var">'v</span> option;</code></td></tr><tr id="type-pre_map_ops.find" class="anchored"><td class="def field"><a href="#type-pre_map_ops.find" class="anchor"></a><code>find : r:<span class="type-var">'r</span> <span>&#45;&gt;</span> k:<span class="type-var">'k</span> <span>&#45;&gt;</span> (<span class="type-var">'r</span> * <span class="type-var">'leaf</span> * <span class="type-var">'frame</span> list, <span class="type-var">'t</span>) Tjr_monad.m;</code></td></tr><tr id="type-pre_map_ops.insert" class="anchored"><td class="def field"><a href="#type-pre_map_ops.insert" class="anchor"></a><code>insert : r:<span class="type-var">'r</span> <span>&#45;&gt;</span> k:<span class="type-var">'k</span> <span>&#45;&gt;</span> v:<span class="type-var">'v</span> <span>&#45;&gt;</span> (<span class="type-var">'r</span> option, <span class="type-var">'t</span>) Tjr_monad.m;</code></td></tr><tr id="type-pre_map_ops.delete" class="anchored"><td class="def field"><a href="#type-pre_map_ops.delete" class="anchor"></a><code>delete : r:<span class="type-var">'r</span> <span>&#45;&gt;</span> k:<span class="type-var">'k</span> <span>&#45;&gt;</span> (<span class="type-var">'r</span>, <span class="type-var">'t</span>) Tjr_monad.m;</code></td></tr></table><code>}</code></dt><dd><p>Pre-map ops, with an explicit root pointer</p></dd></dl></details></div></div></div></section><section><header><h3 id="store-ops"><a href="#store-ops" class="anchor"></a>Store ops</h3></header><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="Isa_export_wrapper/index.html#module-Store_ops_type">Isa_export_wrapper.Store_ops_type</a></code></span></summary><dl><dt class="spec type" id="type-store_ops"><a href="#type-store_ops" class="anchor"></a><code><span class="keyword">type</span> ('r, 'dnode, 't) store_ops</code><code> = </code><code>{</code><table class="record"><tr id="type-store_ops.read" class="anchored"><td class="def field"><a href="#type-store_ops.read" class="anchor"></a><code>read : <span class="type-var">'r</span> <span>&#45;&gt;</span> (<span class="type-var">'dnode</span>, <span class="type-var">'t</span>) Tjr_monad.m;</code></td></tr><tr id="type-store_ops.wrte" class="anchored"><td class="def field"><a href="#type-store_ops.wrte" class="anchor"></a><code>wrte : <span class="type-var">'dnode</span> <span>&#45;&gt;</span> (<span class="type-var">'r</span>, <span class="type-var">'t</span>) Tjr_monad.m;</code></td></tr><tr id="type-store_ops.rewrite" class="anchored"><td class="def field"><a href="#type-store_ops.rewrite" class="anchor"></a><code>rewrite : <span class="type-var">'r</span> <span>&#45;&gt;</span> <span class="type-var">'dnode</span> <span>&#45;&gt;</span> (<span class="type-var">'r</span> option, <span class="type-var">'t</span>) Tjr_monad.m;</code></td></tr><tr id="type-store_ops.free" class="anchored"><td class="def field"><a href="#type-store_ops.free" class="anchor"></a><code>free : <span class="type-var">'r</span> list <span>&#45;&gt;</span> (unit, <span class="type-var">'t</span>) Tjr_monad.m;</code></td></tr></table><code>}</code></dt></dl></details></div></div></div></section><section><header><h3 id="main-functionality:-make_isa_btree"><a href="#main-functionality:-make_isa_btree" class="anchor"></a>Main functionality: make_isa_btree</h3></header><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="Isa_export_wrapper/index.html#module-Internal_export">Isa_export_wrapper.Internal_export</a></code></span></summary><dl><dt class="spec type" id="type-node_impl"><a href="#type-node_impl" class="anchor"></a><code><span class="keyword">type</span> ('k, 'r) node_impl</code></dt><dt class="spec type" id="type-leaf_impl"><a href="#type-leaf_impl" class="anchor"></a><code><span class="keyword">type</span> ('k, 'v) leaf_impl</code></dt></dl><dl><dt class="spec value" id="val-node_leaf_conversions"><a href="#val-node_leaf_conversions" class="anchor"></a><code><span class="keyword">val</span> node_leaf_conversions : k_cmp:(<span class="type-var">'k</span> <span>&#45;&gt;</span> <span class="type-var">'k</span> <span>&#45;&gt;</span> int) <span>&#45;&gt;</span> (<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'r</span>, (<span class="type-var">'k</span>, <span class="type-var">'r</span>) <a href="index.html#type-node_impl">node_impl</a>, (<span class="type-var">'k</span>, <span class="type-var">'v</span>) <a href="index.html#type-leaf_impl">leaf_impl</a>) <a href="Isa_export_wrapper/Node_leaf_conversions_type/index.html#type-node_leaf_conversions">Isa_export_wrapper.Node_leaf_conversions_type.node_leaf_conversions</a></code></dt></dl><dl><dt class="spec type" id="type-dnode_impl"><a href="#type-dnode_impl" class="anchor"></a><code><span class="keyword">type</span> ('k, 'v, 'r) dnode_impl</code><code> = ((<span class="type-var">'k</span>, <span class="type-var">'r</span>) <a href="index.html#type-node_impl">node_impl</a>, (<span class="type-var">'k</span>, <span class="type-var">'v</span>) <a href="index.html#type-leaf_impl">leaf_impl</a>) <a href="Isa_export_wrapper/index.html#type-dnode">Isa_export_wrapper.dnode</a></code></dt><dt class="spec type" id="type-frame_impl"><a href="#type-frame_impl" class="anchor"></a><code><span class="keyword">type</span> ('k, 'r) frame_impl</code></dt><dt class="spec type" id="type-leaf_stream_impl"><a href="#type-leaf_stream_impl" class="anchor"></a><code><span class="keyword">type</span> ('k, 'v, 'r) leaf_stream_impl</code></dt><dt class="spec type" id="type-isa_btree"><a href="#type-isa_btree" class="anchor"></a><code><span class="keyword">type</span> ('k, 'v, 'r, 't) isa_btree</code></dt><dd><p>The <code>isa_btree</code> type is what is exported by the make function; use the projections such as pre_map_ops to break this down</p><p>Internal impl: <pre>
  type ('k,'v,'r,'a) isa_btree = 
    ('k, 'v, 'r, ('k, 'v) leaf_impl, ('k, 'r) frame_impl, 'a) pre_map_ops 
    * ('r, ('k,'v)leaf_impl, ('k,'v,'r) leaf_stream_impl, 'a) leaf_stream_ops 
    * ('k, 'v, ('k, 'v) leaf_impl) leaf_ops 
    * ('k, 'r, ('k, 'r) node_impl) node_ops
    * ('k, 'r, ('k, 'r) frame_impl, ('k,'r) node_impl) frame_ops 
    * (('k * 'v) list -> ('k, 'v) leaf_impl)
    * ('k list * 'r list -> ('k,'r) node_impl)
</pre></p></dd></dl><dl><dt class="spec value" id="val-make_isa_btree"><a href="#val-make_isa_btree" class="anchor"></a><code><span class="keyword">val</span> make_isa_btree : monad_ops:<span class="type-var">'a</span> Tjr_monad.monad_ops <span>&#45;&gt;</span> cs:<a href="Constants/index.html#type-constants">Constants.constants</a> <span>&#45;&gt;</span> k_cmp:(<span class="type-var">'k</span> <span>&#45;&gt;</span> <span class="type-var">'k</span> <span>&#45;&gt;</span> int) <span>&#45;&gt;</span> store_ops:(<span class="type-var">'r</span>, ((<span class="type-var">'k</span>, <span class="type-var">'r</span>) <a href="index.html#type-node_impl">node_impl</a>, (<span class="type-var">'k</span>, <span class="type-var">'v</span>) <a href="index.html#type-leaf_impl">leaf_impl</a>) <a href="Isa_export_wrapper/index.html#type-dnode">Isa_export_wrapper.dnode</a>, <span class="type-var">'a</span>) <a href="Isa_export_wrapper/index.html#type-store_ops">Isa_export_wrapper.store_ops</a> <span>&#45;&gt;</span> dbg_tree_at_r:(<span class="type-var">'r</span> <span>&#45;&gt;</span> (unit, <span class="type-var">'a</span>) Tjr_monad.m) <span>&#45;&gt;</span> (<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'r</span>, <span class="type-var">'a</span>) <a href="index.html#type-isa_btree">isa_btree</a></code></dt><dd><p>Prettier type (essentially <code>store_ops -&gt; isa_btree</code>): 
<pre>
    monad_ops:'a monad_ops ->
    cs:constants ->
    k_cmp:('k -> 'k -> int) ->
    store_ops:('r, (('k, 'r) node_impl, ('k, 'v) leaf_impl) dnode, 'a) store_ops ->
    dbg_tree_at_r:('r -> (unit, 'a) m) ->
    ('k,'v,'r,'a)isa_btree
</pre> </p></dd></dl><dl><dt class="spec value" id="val-pre_map_ops"><a href="#val-pre_map_ops" class="anchor"></a><code><span class="keyword">val</span> pre_map_ops : (<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'r</span>, <span class="type-var">'a</span>) <a href="index.html#type-isa_btree">isa_btree</a> <span>&#45;&gt;</span> (<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'r</span>, (<span class="type-var">'k</span>, <span class="type-var">'v</span>) <a href="index.html#type-leaf_impl">leaf_impl</a>, (<span class="type-var">'k</span>, <span class="type-var">'r</span>) <a href="index.html#type-frame_impl">frame_impl</a>, <span class="type-var">'a</span>) <a href="Isa_export_wrapper/index.html#type-pre_map_ops">Isa_export_wrapper.pre_map_ops</a></code></dt></dl></details></div></div></div></section><section><header><h3 id="internal-interfaces"><a href="#internal-interfaces" class="anchor"></a>Internal interfaces</h3></header><dl><dt class="spec module" id="module-Isa_export"><a href="#module-Isa_export" class="anchor"></a><code><span class="keyword">module</span> <a href="Isa_export/index.html">Isa_export</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>This file is exported from Isabelle, and lightly patched (eg to include this comment!). The OCaml interfaces wrap this basic functionality.</p></dd></dl><dl><dt class="spec module" id="module-Isa_export_wrapper"><a href="#module-Isa_export_wrapper" class="anchor"></a><code><span class="keyword">module</span> <a href="Isa_export_wrapper/index.html">Isa_export_wrapper</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Wrap Isabelle-exported code in an OCaml-friendly interface</p></dd></dl></section></div></body></html>